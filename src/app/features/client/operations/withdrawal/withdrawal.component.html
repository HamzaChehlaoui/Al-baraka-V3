<div class="operation-container">
  <div class="operation-card">
    <h1>Effectuer un Retrait</h1>

    <form [formGroup]="withdrawalForm" (ngSubmit)="onSubmit()">
      <div class="form-group">
        <label for="amount">Montant (DH)</label>
        <input
          id="amount"
          type="number"
          formControlName="amount"
          placeholder="Entrez le montant"
          min="0.01"
          step="0.01"
          class="form-control"
        />
        <small class="error" *ngIf="withdrawalForm.get('amount')?.invalid && withdrawalForm.get('amount')?.touched">
          Le montant est requis et doit être positif
        </small>
      </div>

      <div class="form-group">
        <label for="withdrawalMethod">Méthode de Retrait</label>
        <select id="withdrawalMethod" formControlName="withdrawalMethod" class="form-control">
          <option value="ATM">Distributeur Automatique (DAB)</option>
          <option value="BANK">Guichet Bancaire</option>
          <option value="CHEQUE">Chèque</option>
        </select>
      </div>

      <div class="form-group">
        <label for="description">Description (optionnel)</label>
        <textarea
          id="description"
          formControlName="description"
          placeholder="Décrivez la raison du retrait"
          rows="4"
          class="form-control"
        ></textarea>
        <small class="info">Max 500 caractères</small>
      </div>

      <!-- Alerte et upload pour montants élevés -->
      <div *ngIf="requiresJustification" class="alert alert-warning">
        ⚠️ Un montant supérieur à 10 000 DH nécessite un justificatif (PDF, JPG, PNG)
      </div>

      <div *ngIf="requiresJustification" class="form-group">
        <label>Justificatif *</label>
        <app-file-upload
          label="Télécharger le justificatif"
          [config]="{accept: '.pdf,.jpg,.jpeg,.png', maxSize: 5, multiple: false}"
          (fileSelected)="onFileSelected($event)"
          (fileRemoved)="onFileRemoved()"
        ></app-file-upload>
      </div>

      <div *ngIf="errorMessage" class="alert alert-error">
        {{ errorMessage }}
      </div>

      <div *ngIf="successMessage" class="alert alert-success">
        {{ successMessage }}
      </div>

      <div class="form-actions">
        <button type="submit" [disabled]="isLoading" class="btn btn-primary">
          {{ isLoading ? 'En cours...' : 'Confirmer le Retrait' }}
        </button>
        <button type="button" (click)="goBack()" class="btn btn-secondary">
          Annuler
        </button>
      </div>
    </form>
  </div>
</div>
